
export const SEM_TAKE_CODE = [
    { line: 1, text: "/* semphr.h maps to queue.c */", type: 'comment' },
    { line: 2, text: "BaseType_t xQueueSemaphoreTake( QueueHandle_t xQueue, TickType_t xTicksToWait )", type: 'func' },
    { line: 3, text: "{", type: 'plain' },
    { line: 4, text: "    taskENTER_CRITICAL();", type: 'macro' },
    { line: 5, text: "    {", type: 'plain' },
    { line: 6, text: "        if( xQueue->uxMessagesWaiting > 0 )", type: 'keyword' },
    { line: 7, text: "        {", type: 'plain' },
    { line: 8, text: "            // Resource Available: Decrement Count", type: 'comment' },
    { line: 9, text: "            xQueue->uxMessagesWaiting--;", type: 'code' },
    { line: 10, text: "            ", type: 'plain' },
    { line: 11, text: "            // If Mutex, record new holder", type: 'comment' },
    { line: 12, text: "            if( xQueue->uxQueueType == queueQUEUE_IS_MUTEX )", type: 'keyword' },
    { line: 13, text: "            {", type: 'plain' },
    { line: 14, text: "                xQueue->pxMutexHolder = pvTaskIncrementMutexHeldCount();", type: 'call' },
    { line: 15, text: "            }", type: 'plain' },
    { line: 16, text: "            return pdPASS;", type: 'keyword' },
    { line: 17, text: "        }", type: 'plain' },
    { line: 18, text: "        else", type: 'keyword' },
    { line: 19, text: "        {", type: 'plain' },
    { line: 20, text: "             // Resource Unavailable: Block Task", type: 'comment' },
    { line: 21, text: "             vTaskPlaceOnEventList( &( xQueue->xTasksWaitingToReceive ), xTicksToWait );", type: 'call' },
    { line: 22, text: "             return errQUEUE_EMPTY;", type: 'keyword' },
    { line: 23, text: "        }", type: 'plain' },
    { line: 24, text: "    }", type: 'plain' },
    { line: 25, text: "    taskEXIT_CRITICAL();", type: 'macro' },
    { line: 26, text: "}", type: 'plain' }
];

export const SEM_GIVE_CODE = [
    { line: 1, text: "/* xSemaphoreGive maps to xQueueGenericSend */", type: 'comment' },
    { line: 2, text: "BaseType_t xQueueGenericSend( QueueHandle_t xQueue, ... )", type: 'func' },
    { line: 3, text: "{", type: 'plain' },
    { line: 4, text: "    taskENTER_CRITICAL();", type: 'macro' },
    { line: 5, text: "    {", type: 'plain' },
    { line: 6, text: "        if( xQueue->uxMessagesWaiting < xQueue->uxLength )", type: 'keyword' },
    { line: 7, text: "        {", type: 'plain' },
    { line: 8, text: "            // Resource Released: Increment Count", type: 'comment' },
    { line: 9, text: "            xQueue->uxMessagesWaiting++;", type: 'code' },
    { line: 10, text: "            ", type: 'plain' },
    { line: 11, text: "            // If Mutex, clear holder", type: 'comment' },
    { line: 12, text: "            if( xQueue->uxQueueType == queueQUEUE_IS_MUTEX )", type: 'keyword' },
    { line: 13, text: "            {", type: 'plain' },
    { line: 14, text: "                xQueue->pxMutexHolder = NULL;", type: 'code' },
    { line: 15, text: "            }", type: 'plain' },
    { line: 16, text: "            ", type: 'plain' },
    { line: 17, text: "            // Wake up waiting tasks", type: 'comment' },
    { line: 18, text: "            if( listLIST_IS_EMPTY( &( xQueue->xTasksWaitingToReceive ) ) == pdFALSE )", type: 'keyword' },
    { line: 19, text: "            {", type: 'plain' },
    { line: 20, text: "                if( xTaskRemoveFromEventList( ... ) ) portYIELD();", type: 'call' },
    { line: 21, text: "            }", type: 'plain' },
    { line: 22, text: "        }", type: 'plain' },
    { line: 23, text: "    }", type: 'plain' },
    { line: 24, text: "    taskEXIT_CRITICAL();", type: 'macro' },
    { line: 25, text: "}", type: 'plain' }
];

export const SEMAPHORE_SCENARIO = [
    { id: 0, text: "初始状态：计数信号量 (Max=3)，当前有3个资源可用。", codeLine: null, mode: 'TAKE' },
    { id: 1, text: "Task A 请求获取信号量 (xQueueSemaphoreTake)", codeLine: 2, mode: 'TAKE', activeTask: 'Take1' },
    { id: 2, text: "内核检查：uxMessagesWaiting > 0 (当前为3)", codeLine: 6, mode: 'TAKE', activeTask: 'Take1' },
    { id: 3, text: "资源递减：uxMessagesWaiting 变为 2", codeLine: 9, mode: 'TAKE', activeTask: 'Take1' },
    { id: 4, text: "Task A 获取成功 (return pdPASS)", codeLine: 16, mode: 'TAKE', activeTask: 'Take1' },
    { id: 5, text: "Task B 请求获取信号量", codeLine: 2, mode: 'TAKE', activeTask: 'Take2' },
    { id: 6, text: "资源递减：uxMessagesWaiting 变为 1", codeLine: 9, mode: 'TAKE', activeTask: 'Take2' },
    { id: 7, text: "Task B 获取成功", codeLine: 16, mode: 'TAKE', activeTask: 'Take2' },
    { id: 8, text: "Task C 请求获取信号量", codeLine: 2, mode: 'TAKE', activeTask: 'Take3' },
    { id: 9, text: "资源递减：uxMessagesWaiting 变为 0 (耗尽)", codeLine: 9, mode: 'TAKE', activeTask: 'Take3' },
    { id: 10, text: "Task C 获取成功", codeLine: 16, mode: 'TAKE', activeTask: 'Take3' },
    { id: 11, text: "Task A 再次尝试获取信号量", codeLine: 2, mode: 'TAKE', activeTask: 'Take1' },
    { id: 12, text: "内核检查：uxMessagesWaiting (0) 不是 > 0", codeLine: 6, mode: 'TAKE', activeTask: 'Take1' },
    { id: 13, text: "资源不足，进入阻塞逻辑 (Else)", codeLine: 18, mode: 'TAKE', activeTask: 'Take1' },
    { id: 14, text: "Task A 被加入等待列表 (Blocked)", codeLine: 21, mode: 'TAKE', activeTask: 'Take1' },
    { id: 15, text: "ISR/Task 释放信号量 (xSemaphoreGive)", codeLine: 2, mode: 'GIVE', activeTask: 'Give1' },
    { id: 16, text: "内核检查：uxMessagesWaiting < Max", codeLine: 6, mode: 'GIVE', activeTask: 'Give1' },
    { id: 17, text: "资源递增：uxMessagesWaiting 变为 1", codeLine: 9, mode: 'GIVE', activeTask: 'Give1' },
    { id: 18, text: "检查等待列表：发现 Task A 正在等待", codeLine: 18, mode: 'GIVE', activeTask: 'Give1' },
    { id: 19, text: "唤醒 Task A (移除阻塞状态)", codeLine: 20, mode: 'GIVE', activeTask: 'Give1' },
    { id: 20, text: "Task A 重新竞争并获取资源 (Count -> 0)", codeLine: 9, mode: 'TAKE', activeTask: 'Take1' },
];
